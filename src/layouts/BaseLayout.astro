---
// src/layouts/BaseLayout.astro
import Background from '../components/Background.astro';
import LinkPreview from '../components/LinkPreview.astro';
import Search from '../components/Search.astro'; // 引入 Search 逻辑
import { ViewTransitions } from 'astro:transitions';

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en" class="h-full bg-void-blue">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title} | TensorFieldX</title>

        <ViewTransitions />

		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
        <script>
            document.addEventListener('astro:page-load', () => {
                // @ts-ignore
                if (window.renderMathInElement) {
                    // @ts-ignore
                    window.renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ]
                    });
                }
            });
        </script>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
        
        <style>
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: #0B1021; }
            ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
            ::-webkit-scrollbar-thumb:hover { background: #CCFF00; }
        </style>
	</head>
	
	<body class="bg-void-blue text-white h-full overflow-hidden p-2 md:p-6 font-mono selection:bg-acid-green selection:text-black relative">
		
        <Background />
        <LinkPreview />
        
        <Search />

        <div class="fixed inset-0 z-[1] opacity-[0.05] pointer-events-none mix-blend-overlay"
             style="background-image: url('https://grainy-gradients.vercel.app/noise.svg');">
        </div>
        
        <div class="fixed top-8 left-8 z-50 pointer-events-none hidden md:block">
            <span class="text-xs font-bold tracking-widest text-acid-green">TENSOR_FIELD_X // SYS_ONLINE</span>
        </div>
        <div class="fixed top-8 right-8 z-50 text-right pointer-events-none hidden md:block">
            <div class="text-[10px] text-gray-500 flex flex-col gap-1">
                <span>MEM: 64KB OK</span>
                <span>LOC: /home/manifold</span>
                <span>UPTIME: 0.04s</span>
            </div>
        </div>
        <div class="fixed left-8 top-1/2 -translate-y-1/2 z-50 hidden md:block" style="writing-mode: vertical-rl;">
            <span class="text-[10px] text-gray-600 tracking-[0.2em] uppercase">Digital Garden</span>
        </div>
        <div class="fixed right-8 top-1/2 -translate-y-1/2 z-50 h-32 w-px bg-white/10 hidden md:block">
            <div class="absolute top-0 left-0 w-full h-1/3 bg-acid-green animate-pulse"></div>
        </div>


        <div class="w-full h-full border border-white/10 relative overflow-y-auto overflow-x-hidden bg-void-blue/60 backdrop-blur-[2px]" id="main-viewport">
            
            <nav class="sticky top-0 z-40 grid grid-cols-2 md:grid-cols-3 items-center p-6 md:p-8 bg-void-blue/90 backdrop-blur-md border-b border-white/10" transition:persist>
                
                <div class="flex justify-start">
                    <a href={import.meta.env.BASE_URL} class="text-2xl font-serif italic font-bold hover:text-acid-green transition-colors">
                        TFX
                    </a>
                </div>

                <div class="hidden md:flex justify-center">
                    <button id="search-trigger" class="
                        group w-64 bg-black/20 border border-white/10 rounded-sm px-4 py-1.5 
                        flex items-center justify-between text-xs font-mono text-gray-500 
                        hover:border-acid-green/50 hover:text-gray-300 hover:bg-black/40 
                        transition-all duration-300 cursor-text
                    ">
                        <span class="group-hover:text-acid-green transition-colors">
                            <span class="mr-2">❯</span>Search
                        </span>
                        <kbd class="hidden lg:inline-block font-sans text-[9px] border border-white/10 px-1 rounded bg-white/5">⌘K</kbd>
                    </button>
                </div>

                <div class="flex justify-end gap-6 text-xs font-bold tracking-tight">
                    <button id="search-trigger" class="md:hidden text-gray-400 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>

                    <a href="/tensorfieldx/notes" class="hidden md:inline hover:text-acid-green hover:underline decoration-1 underline-offset-4">NOTES</a>
                    <a href="/tensorfieldx/projects" class="hidden md:inline hover:text-acid-green hover:underline decoration-1 underline-offset-4">BLUEPRINTS</a>
<a href="/tensorfieldx/about" class="hover:text-acid-green hover:underline decoration-1 underline-offset-4">ABOUT</a>                </div>
            </nav>

            <main class="relative z-10 min-h-screen" transition:animate="fade">
                <slot />
            </main>

            <footer class="border-t border-white/10 p-8 text-[10px] text-center text-gray-600 font-mono uppercase tracking-widest">
                End of File // Manifold // 2026
            </footer>

        </div>
	</body>
</html>