---
import Background from '../components/Background.astro';
import LinkPreview from '../components/LinkPreview.astro';
import Search from '../components/Search.astro';
import { ViewTransitions } from 'astro:transitions';

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en" class="h-full bg-void">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title} | Feixiang Tao</title>

        <ViewTransitions />

		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
        <script>
            document.addEventListener('astro:page-load', () => {
                // @ts-ignore
                if (window.renderMathInElement) {
                    // @ts-ignore
                    window.renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ]
                    });
                }
            });
        </script>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
        
        <style>
            /* 1. 滚动条：蓝色点缀 */
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: #080808; }
            ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
            ::-webkit-scrollbar-thumb:hover { background: #3B82F6; }

            /* 2. 选中色：回归经典的蓝底白字 (High Contrast) */
            ::selection { background: #3B82F6; color: #FFFFFF; }

            /* 3. 噪点：保持微弱质感 */
            .noise-overlay {
                position: fixed;
                top: 0; left: 0; width: 100%; height: 100%;
                pointer-events: none;
                z-index: 9998;
                opacity: 0.03;
                background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            }
        </style>
	</head>
	
	<body class="bg-void text-ink h-full overflow-hidden p-0 md:p-4 font-mono relative">
		
        <Background />
        <LinkPreview />
        <Search />

        <div class="noise-overlay"></div>
        
        <div class="fixed top-6 left-6 z-50 pointer-events-none hidden md:block">
            <div class="flex items-center gap-2 border border-white/10 bg-void/50 px-2 py-1 backdrop-blur-sm rounded-sm">
                <span class="w-1.5 h-1.5 bg-accent rounded-full animate-pulse"></span>
                <span class="text-[10px] font-bold tracking-widest text-concrete">SYS_ONLINE</span>
            </div>
        </div>
        
        <div class="fixed bottom-6 right-6 z-50 pointer-events-none hidden md:block">
             <span class="text-[10px] font-mono text-concrete border-l border-accent pl-2">
                ~/manifold/root
             </span>
        </div>

        <div class="w-full h-full border border-white/10 relative overflow-y-auto overflow-x-hidden bg-void/60 backdrop-blur-[2px]" id="main-viewport">
            
            <nav class="sticky top-0 z-40 flex justify-between items-center p-6 border-b border-white/10 bg-void/90 backdrop-blur-md" transition:persist>
                
                <div class="flex items-center gap-6">
                    <a href={import.meta.env.BASE_URL} class="text-2xl font-serif italic font-bold text-white hover:text-accent transition-colors">
                        TFX
                    </a>
                </div>

                <div class="hidden md:block absolute left-1/2 -translate-x-1/2">
                     <button id="search-trigger" class="flex items-center gap-3 px-4 py-1.5 border border-white/10 bg-white/5 hover:border-accent/50 hover:bg-white/10 transition-all group rounded-sm">
                        <span class="text-xs text-concrete group-hover:text-accent font-mono transition-colors">> Search_Index</span>
                        <kbd class="text-[9px] border border-white/10 px-1 text-concrete bg-black">⌘K</kbd>
                     </button>
                </div>

                <div class="flex gap-8 text-xs font-bold tracking-tight text-concrete">
                    <a href="/notes" class="hover:text-white transition-colors relative group">
                        NOTES
                        <span class="absolute -bottom-2 left-0 w-0 h-[2px] bg-accent transition-all group-hover:w-full"></span>
                    </a>
                    <a href="/projects" class="hover:text-white transition-colors relative group">
                        ARCHIVES
                        <span class="absolute -bottom-2 left-0 w-0 h-[2px] bg-accent transition-all group-hover:w-full"></span>
                    </a>
                    <a href="/about" class="hover:text-white transition-colors relative group">
                        ABOUT
                        <span class="absolute -bottom-2 left-0 w-0 h-[2px] bg-accent transition-all group-hover:w-full"></span>
                    </a>
                </div>
            </nav>

            <main class="relative z-10 min-h-screen" transition:animate="fade">
                <slot />
            </main>

            <footer class="border-t border-white/10 p-12 text-[10px] text-center text-concrete font-mono uppercase tracking-widest">
                Feixiang Tao // 2026 // Shenzhen
            </footer>

        </div>
	</body>
</html>