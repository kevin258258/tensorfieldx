---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allNotes = await getCollection('notes');
const sortedNotes = allNotes.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Home">
	
	<section class="min-h-[60vh] flex flex-col justify-center items-center relative p-4 border-b border-white/10">
        
        <div class="absolute top-6 left-6 font-mono text-xs text-accent border border-accent px-2 py-1 animate-pulse">
            :: SYSTEM_READY
        </div>

		<div class="relative z-10 text-center w-full max-w-4xl">
            <a id="math-link" href="#" target="_blank" class="block group relative min-h-[120px] flex flex-col justify-center items-center mb-12 cursor-help">
                <div id="formula-raw" class="font-mono text-sm md:text-base text-accent bg-black px-4 py-2 border border-accent/50 group-hover:bg-accent group-hover:text-black transition-colors"></div>
                <div id="formula-render" class="hidden text-3xl md:text-5xl lg:text-7xl font-serif text-ink group-hover:scale-105 transition-transform duration-100"></div>
                <div class="absolute -bottom-8 opacity-0 group-hover:opacity-100 transition-opacity duration-0">
                    <span class="font-mono text-[10px] text-black bg-accent px-2 py-1 font-bold">
                        [DECRYPT_SOURCE]
                    </span>
                </div>
            </a>
            
            <h1 class="font-serif text-6xl md:text-8xl lg:text-9xl leading-none tracking-tighter text-white mix-blend-difference">
                Tensor<span class="text-accent font-normal italic">Field</span>X
            </h1>
		</div>
	</section>

    <section class="border-b border-white/10 bg-void">
        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12">
            <div class="lg:col-span-4 p-8 border-b lg:border-b-0 lg:border-r border-white/10 flex flex-col justify-center">
                <div class="font-mono text-[10px] text-concrete mb-4 tracking-widest">// IDENTITY</div>
                <div class="flex items-center gap-6 mb-6">
                    <div class="w-16 h-16 bg-accent text-black flex items-center justify-center text-4xl font-serif italic font-bold">T</div>
                    <div><h3 class="text-white font-serif text-2xl">Feixiang Tao</h3><p class="text-accent font-mono text-xs mt-1">CS Freshman @ SUSTech</p></div>
                </div>
                <ul class="space-y-3 font-mono text-xs text-concrete">
                    <li class="flex justify-between border-b border-white/5 pb-1"><span>MAJOR</span><span class="text-ink">Computer Science</span></li>
                    <li class="flex justify-between border-b border-white/5 pb-1"><span>FOCUS</span><span class="text-ink">Physics / Math / AI</span></li>
                </ul>
            </div>

            <div class="lg:col-span-8 p-12 flex flex-col justify-center relative">
                <div class="absolute top-0 right-0 p-4 text-9xl font-serif text-white/5 pointer-events-none select-none font-bold leading-none overflow-hidden">
                    HELLO
                </div>
                <div class="prose prose-invert prose-lg max-w-none relative z-10">
                    <p class="font-serif text-2xl md:text-3xl leading-snug text-ink">
                        "Documenting my undergraduate journey at <span class="text-accent border-b border-accent">SUSTech</span>."
                    </p>
                    <p class="font-mono text-xs md:text-sm text-concrete mt-6 leading-loose max-w-2xl">
                        Welcome to my personal archive. Here, I record my learning process in Computer Science, Physics, and Mathematics. 
                        This site serves as a repository for my course notes, technical explorations, and project blueprints.
                        <br/><br/>
                        <span class="text-ink">Simple, open, and always learning.</span>
                    </p>
                </div>
            </div>
        </div>
    </section>

	<section class="py-24 border-b border-white/10 bg-void">
        <div class="max-w-7xl mx-auto px-6">
            <div class="font-mono text-xs text-concrete mb-12 flex items-center gap-4">
                <span class="w-3 h-3 bg-accent"></span>
                ACCESS_MODULES:
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-0 border border-white/10">
                <a href="/notes" class="group md:col-span-2 relative border-b md:border-b-0 md:border-r border-white/10 bg-void p-12 flex flex-col justify-between hover:bg-white/5 transition-colors duration-0">
                    <span class="absolute right-4 bottom-0 text-[180px] font-serif font-bold text-white/5 group-hover:text-accent/10 transition-colors leading-none">N</span>
                    <div>
                        <h3 class="text-4xl font-serif font-bold text-white group-hover:text-accent transition-colors">Notes</h3>
                        <p class="font-mono text-xs text-concrete mt-4 max-w-sm">
                            Documentation of learning processes in Matrix Calculus, Statistical Mechanics, and System Architecture.
                        </p>
                    </div>
                    <div class="flex items-center gap-2 font-mono text-xs text-accent mt-12 group-hover:underline decoration-2">
                        <span>ENTER_DB</span> ->
                    </div>
                </a>

                <div class="flex flex-col">
                    <a href="/projects" class="group flex-1 relative border-b border-white/10 bg-void p-8 flex flex-col justify-center hover:bg-white/5 transition-colors duration-0">
                        <div class="absolute top-4 right-4 text-[10px] font-mono border border-white/20 px-1 text-concrete">EXE</div>
                        <h3 class="text-2xl font-serif font-bold mb-2 text-white group-hover:text-accent transition-colors">Archives</h3>
                        <p class="font-mono text-[10px] text-concrete">Experiments & Coursework.</p>
                    </a>
                    <a href="/about" class="group flex-1 relative bg-void p-8 flex flex-col justify-center hover:bg-white/5 transition-colors duration-0">
                        <div class="absolute top-4 right-4 text-[10px] font-mono border border-white/20 px-1 text-concrete">USR</div>
                        <h3 class="text-2xl font-serif font-bold mb-2 text-white group-hover:text-accent transition-colors">About</h3>
                        <p class="font-mono text-[10px] text-concrete">Profile & Contact.</p>
                    </a>
                </div>
            </div>
        </div>
    </section>

	<section class="bg-void py-24">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="font-mono text-xs text-concrete mb-8 flex items-center gap-2"><span class="w-2 h-2 bg-concrete"></span>RECENT_LOGS:</h2>
            <div class="border-t border-b border-white/10">
                {sortedNotes.slice(0, 5).map((note, index) => {
                    const hexId = `0x${(sortedNotes.length - index).toString(16).padStart(2, '0').toUpperCase()}`;
                    return (
                        <a href={`/notes/${note.slug}`} class="group grid grid-cols-12 gap-4 px-4 py-6 items-baseline border-b border-white/5 last:border-0 hover:bg-accent hover:text-white transition-colors duration-0">
                            <div class="col-span-2 md:col-span-1 font-mono text-xs text-concrete group-hover:text-white font-bold">{hexId}</div>
                            <div class="col-span-3 md:col-span-2 font-mono text-xs text-ink group-hover:text-white">{note.data.pubDate.toISOString().split('T')[0]}</div>
                            <div class="col-span-7 md:col-span-6"><h3 class="font-serif text-xl font-bold text-white group-hover:text-white">{note.data.title}</h3></div>
                            <div class="col-span-2 md:col-span-2 text-right hidden md:block font-mono text-xs text-concrete group-hover:text-white">[{note.data.tags?.[0]}]</div>
                            <div class="col-span-1 text-right hidden md:block font-mono text-xs text-concrete group-hover:text-white">-></div>
                        </a>
                    )
                })}
            </div>
            <div class="mt-12 text-center">
                 <a href="/notes" class="inline-block border border-white/10 px-8 py-3 font-mono text-xs text-accent hover:bg-accent hover:text-white hover:border-accent transition-colors font-bold">VIEW_ALL_RECORDS</a>
            </div>
        </div>
	</section>

</BaseLayout>

<script>
    // ... Math Hero Script ...
    // (保留之前的 Script 代码，不需要修改)
 const formulas = [
    // --- 物理学 (Physics) ---
    // 1. 薛定谔方程 (量子力学) - 极其紧凑的形式
    { tex: "i\\hbar\\dot{\\Psi} = \\hat{H}\\Psi", link: "https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation" },
    // 2. 质能方程 (狭义相对论) - 标志性极短公式
    { tex: "E = mc^2", link: "https://en.wikipedia.org/wiki/Mass%E2%80%93energy_equivalence" },
    // 3. 爱因斯坦场方程 (广义相对论) - 紧凑张量形式
    { tex: "G_{\\mu\\nu} + \\Lambda g_{\\mu\\nu} = \\kappa T_{\\mu\\nu}", link: "https://en.wikipedia.org/wiki/Einstein_field_equations" },
    // 4. 狄拉克方程 (相对论量子力学)
    { tex: "(i\\gamma^\\mu \\partial_\\mu - m)\\psi = 0", link: "https://en.wikipedia.org/wiki/Dirac_equation" },
    // 5. 海森堡不确定性原理 (量子力学)
    { tex: "\\Delta x \\Delta p \\geq \\frac{\\hbar}{2}", link: "https://en.wikipedia.org/wiki/Uncertainty_principle" },
    // 6. 麦克斯韦方程 (高斯定律) - 选用最短的一个
    { tex: "\\nabla \\cdot \\mathbf{E} = \\frac{\\rho}{\\varepsilon_0}", link: "https://en.wikipedia.org/wiki/Maxwell%27s_equations" },
    // 7. 玻尔兹曼熵 (热力学) - 墓志铭上的公式
    { tex: "S = k_B \\ln \\Omega", link: "https://en.wikipedia.org/wiki/Boltzmann%27s_entropy_formula" },
    // 8. 普朗克关系式 (量子理论基础)
    { tex: "E = h\\nu", link: "https://en.wikipedia.org/wiki/Planck_relation" },
    // 9. 热力学第二定律 (熵增)
    { tex: "dS \\geq 0", link: "https://en.wikipedia.org/wiki/Second_law_of_thermodynamics" },
    // 10. 波动方程 (经典物理)
    { tex: "\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\nabla^2 u", link: "https://en.wikipedia.org/wiki/Wave_equation" },
    // 11. 德布罗意波长 (波粒二象性)
    { tex: "\\lambda = \\frac{h}{p}", link: "https://en.wikipedia.org/wiki/Matter_wave" },
    // 12. 胡克定律 (经典力学) - 极简
    { tex: "F = -kx", link: "https://en.wikipedia.org/wiki/Hooke%27s_law" },

    // --- 数学 (Mathematics) ---
    // 13. 欧拉公式 (数学最美公式)
    { tex: "e^{i\\pi} + 1 = 0", link: "https://en.wikipedia.org/wiki/Euler%27s_identity" },
    // 14. 傅里叶变换 (你的基准长度)
    { tex: "\\hat{f}(\\xi) = \\int f(x) e^{-2\\pi i x \\xi} dx", link: "https://en.wikipedia.org/wiki/Fourier_transform" },
    // 15. 贝叶斯定理 (概率论)
    { tex: "P(A|B) = \\frac{P(B|A)P(A)}{P(B)}", link: "https://en.wikipedia.org/wiki/Bayes%27_theorem" },
    // 16. 微积分基本定理 (微积分)
    { tex: "\\int_a^b f'(x) dx = f(b) - f(a)", link: "https://en.wikipedia.org/wiki/Fundamental_theorem_of_calculus" },
    // 17. 黎曼 Zeta 函数 (数论)
    { tex: "\\zeta(s) = \\sum_{n=1}^{\\infty} n^{-s}", link: "https://en.wikipedia.org/wiki/Riemann_zeta_function" },
    // 18. 柯西-施瓦茨不等式 (线性代数)
    { tex: "|\\langle \\mathbf{u},\\mathbf{v} \\rangle|^2 \\leq \\langle \\mathbf{u},\\mathbf{u} \\rangle \\cdot \\langle \\mathbf{v},\\mathbf{v} \\rangle", link: "https://en.wikipedia.org/wiki/Cauchy%E2%80%93Schwarz_inequality" },
    // 19. 黄金分割比 (几何)
    { tex: "\\phi = \\frac{1 + \\sqrt{5}}{2}", link: "https://en.wikipedia.org/wiki/Golden_ratio" },
    // 20. 正态分布概率密度 (简化版，去掉长系数)
    { tex: "f(x) \\propto e^{-\\frac{1}{2}x^2}", link: "https://en.wikipedia.org/wiki/Normal_distribution" },
    // 21. 斯托克斯定理 (向量分析)
    { tex: "\\int_{\\partial\\Omega} \\omega = \\int_\\Omega d\\omega", link: "https://en.wikipedia.org/wiki/Stokes%27_theorem" },

    // --- 人工智能 (AI / CS) ---
    // 22. 梯度下降更新规则 (优化算法)
    { tex: "\\theta_{t+1} = \\theta_t - \\alpha \\nabla J(\\theta)", link: "https://en.wikipedia.org/wiki/Gradient_descent" },
    // 23. Attention 注意力机制 (Transformer核心) - 紧凑版
    { tex: "\\text{Attention}(Q,K,V) = \\text{softmax}(\\frac{QK^T}{\\sqrt{d}})V", link: "https://en.wikipedia.org/wiki/Attention_(machine_learning)" },
    // 24. Sigmoid 激活函数
    { tex: "\\sigma(z) = \\frac{1}{1 + e^{-z}}", link: "https://en.wikipedia.org/wiki/Sigmoid_function" },
    // 25. ReLU 激活函数 (极简)
    { tex: "f(x) = \\max(0, x)", link: "https://en.wikipedia.org/wiki/Rectifier_(neural_networks)" },
    // 26. 贝尔曼方程 (强化学习)
    { tex: "V(s) = \\max_a (R + \\gamma \\sum P V(s'))", link: "https://en.wikipedia.org/wiki/Bellman_equation" },
    // 27. KL 散度 (信息论/机器学习) - 选用求和形式，不用积分
    { tex: "D_{KL}(P||Q) = \\sum P(x) \\ln \\frac{P(x)}{Q(x)}", link: "https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence" },
    // 28. 大O表示法 (算法复杂度)
    { tex: "f(x) = O(g(x))", link: "https://en.wikipedia.org/wiki/Big_O_notation" },
    // 29. 逻辑回归模型
    { tex: "P(Y=1) = \\frac{1}{1 + e^{-(\\beta_0 + \\beta x)}}", link: "https://en.wikipedia.org/wiki/Logistic_regression" },
    // 30. P vs NP 问题 (计算机科学皇冠)
    { tex: "P \\overset{?}{=} NP", link: "https://en.wikipedia.org/wiki/P_versus_NP_problem" }
];

    function initMathHero() {
        // ... 逻辑同上 ...
        const rawEl = document.getElementById('formula-raw');
        const renderEl = document.getElementById('formula-render');
        const linkEl = document.getElementById('math-link');

        if (!renderEl || !linkEl) return;
        if(rawEl) rawEl.style.display = 'none';

        const selected = formulas[Math.floor(Math.random() * formulas.length)];
        linkEl.setAttribute('href', selected.link);

        renderEl.classList.remove('hidden');
        renderEl.innerHTML = "";

        // @ts-ignore
        if (typeof window.katex === 'undefined') {
            renderEl.innerText = selected.tex;
            renderEl.style.fontFamily = 'monospace';
            return;
        }

        try {
            // @ts-ignore
            window.katex.render(selected.tex, renderEl, { throwOnError: false, displayMode: true });
        } catch (e) { renderEl.innerText = selected.tex; }

        const symbols = renderEl.querySelectorAll('.katex-html .mord, .katex-html .mbin, .katex-html .mrel, .katex-html .mopen, .katex-html .mclose, .katex-html .mpunct, .katex-html .minner');
        
        if (symbols.length === 0) { renderEl.style.opacity = '1'; return; }

        symbols.forEach(el => { (el as HTMLElement).style.opacity = '0'; (el as HTMLElement).style.transition = 'opacity 0.1s ease-out'; });

        let delay = 0;
        const step = 30;
        symbols.forEach((el) => { setTimeout(() => { (el as HTMLElement).style.opacity = '1'; }, delay); delay += step; });
        setTimeout(() => { const allSpans = renderEl.querySelectorAll('span'); allSpans.forEach(el => el.style.opacity = '1'); }, delay + 500);
    }
    document.addEventListener('astro:page-load', initMathHero);
</script>