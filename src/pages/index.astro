---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allNotes = await getCollection('notes');
const sortedNotes = allNotes.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Home">
	
	<section class="min-h-[60vh] flex flex-col justify-center items-center relative p-4 border-b border-white/10">
        
        <div class="absolute top-6 left-6 font-mono text-xs text-accent border border-accent px-2 py-1 animate-pulse">
            :: SYSTEM_READY
        </div>

		<div class="relative z-10 text-center w-full max-w-4xl">
            <a id="math-link" href="#" target="_blank" class="block group relative min-h-[120px] flex flex-col justify-center items-center mb-12 cursor-help">
                <div id="formula-raw" class="font-mono text-sm md:text-base text-accent bg-black px-4 py-2 border border-accent/50 group-hover:bg-accent group-hover:text-black transition-colors"></div>
                <div id="formula-render" class="hidden text-3xl md:text-5xl lg:text-7xl font-serif text-ink group-hover:scale-105 transition-transform duration-100"></div>
                <div class="absolute -bottom-8 opacity-0 group-hover:opacity-100 transition-opacity duration-0">
                    <span class="font-mono text-[10px] text-black bg-accent px-2 py-1 font-bold">
                        [DECRYPT_SOURCE]
                    </span>
                </div>
            </a>
            
            <h1 class="font-serif text-6xl md:text-8xl lg:text-9xl leading-none tracking-tighter text-white mix-blend-difference">
                Tensor<span class="text-accent font-normal italic">Field</span>X
            </h1>
		</div>
	</section>

    <section class="border-b border-white/10 bg-void">
        <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12">
            <div class="lg:col-span-4 p-8 border-b lg:border-b-0 lg:border-r border-white/10 flex flex-col justify-center">
                <div class="font-mono text-[10px] text-concrete mb-4 tracking-widest">// IDENTITY</div>
                <div class="flex items-center gap-6 mb-6">
                    <div class="w-16 h-16 bg-accent text-black flex items-center justify-center text-4xl font-serif italic font-bold">T</div>
                    <div><h3 class="text-white font-serif text-2xl">Feixiang Tao</h3><p class="text-accent font-mono text-xs mt-1">CS Freshman @ SUSTech</p></div>
                </div>
                <ul class="space-y-3 font-mono text-xs text-concrete">
                    <li class="flex justify-between border-b border-white/5 pb-1"><span>MAJOR</span><span class="text-ink">Computer Science</span></li>
                    <li class="flex justify-between border-b border-white/5 pb-1"><span>FOCUS</span><span class="text-ink">Physics / Math / AI</span></li>
                </ul>
            </div>

            <div class="lg:col-span-8 p-12 flex flex-col justify-center relative">
                <div class="absolute top-0 right-0 p-4 text-9xl font-serif text-white/5 pointer-events-none select-none font-bold leading-none overflow-hidden">
                    HELLO
                </div>
                <div class="prose prose-invert prose-lg max-w-none relative z-10">
                    <p class="font-serif text-2xl md:text-3xl leading-snug text-ink">
                        "Documenting my undergraduate journey at <span class="text-accent border-b border-accent">SUSTech</span>."
                    </p>
                    <p class="font-mono text-xs md:text-sm text-concrete mt-6 leading-loose max-w-2xl">
                        Welcome to my personal archive. Here, I record my learning process in Computer Science, Physics, and Mathematics. 
                        This site serves as a repository for my course notes, technical explorations, and project blueprints.
                        <br/><br/>
                        <span class="text-ink">Simple, open, and always learning.</span>
                    </p>
                </div>
            </div>
        </div>
    </section>

	<section class="py-24 border-b border-white/10 bg-void">
        <div class="max-w-7xl mx-auto px-6">
            <div class="font-mono text-xs text-concrete mb-12 flex items-center gap-4">
                <span class="w-3 h-3 bg-accent"></span>
                ACCESS_MODULES:
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-0 border border-white/10">
                <a href="/notes" class="group md:col-span-2 relative border-b md:border-b-0 md:border-r border-white/10 bg-void p-12 flex flex-col justify-between hover:bg-white/5 transition-colors duration-0">
                    <span class="absolute right-4 bottom-0 text-[180px] font-serif font-bold text-white/5 group-hover:text-accent/10 transition-colors leading-none">N</span>
                    <div>
                        <h3 class="text-4xl font-serif font-bold text-white group-hover:text-accent transition-colors">Notes</h3>
                        <p class="font-mono text-xs text-concrete mt-4 max-w-sm">
                            Documentation of learning processes in Matrix Calculus, Statistical Mechanics, and System Architecture.
                        </p>
                    </div>
                    <div class="flex items-center gap-2 font-mono text-xs text-accent mt-12 group-hover:underline decoration-2">
                        <span>ENTER_DB</span> ->
                    </div>
                </a>

                <div class="flex flex-col">
                    <a href="/projects" class="group flex-1 relative border-b border-white/10 bg-void p-8 flex flex-col justify-center hover:bg-white/5 transition-colors duration-0">
                        <div class="absolute top-4 right-4 text-[10px] font-mono border border-white/20 px-1 text-concrete">EXE</div>
                        <h3 class="text-2xl font-serif font-bold mb-2 text-white group-hover:text-accent transition-colors">Archives</h3>
                        <p class="font-mono text-[10px] text-concrete">Experiments & Coursework.</p>
                    </a>
                    <a href="/about" class="group flex-1 relative bg-void p-8 flex flex-col justify-center hover:bg-white/5 transition-colors duration-0">
                        <div class="absolute top-4 right-4 text-[10px] font-mono border border-white/20 px-1 text-concrete">USR</div>
                        <h3 class="text-2xl font-serif font-bold mb-2 text-white group-hover:text-accent transition-colors">About</h3>
                        <p class="font-mono text-[10px] text-concrete">Profile & Contact.</p>
                    </a>
                </div>
            </div>
        </div>
    </section>

	<section class="bg-void py-24">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="font-mono text-xs text-concrete mb-8 flex items-center gap-2"><span class="w-2 h-2 bg-concrete"></span>RECENT_LOGS:</h2>
            <div class="border-t border-b border-white/10">
                {sortedNotes.slice(0, 5).map((note, index) => {
                    const hexId = `0x${(sortedNotes.length - index).toString(16).padStart(2, '0').toUpperCase()}`;
                    return (
                        <a href={`/notes/${note.slug}`} class="group grid grid-cols-12 gap-4 px-4 py-6 items-baseline border-b border-white/5 last:border-0 hover:bg-accent hover:text-white transition-colors duration-0">
                            <div class="col-span-2 md:col-span-1 font-mono text-xs text-concrete group-hover:text-white font-bold">{hexId}</div>
                            <div class="col-span-3 md:col-span-2 font-mono text-xs text-ink group-hover:text-white">{note.data.pubDate.toISOString().split('T')[0]}</div>
                            <div class="col-span-7 md:col-span-6"><h3 class="font-serif text-xl font-bold text-white group-hover:text-white">{note.data.title}</h3></div>
                            <div class="col-span-2 md:col-span-2 text-right hidden md:block font-mono text-xs text-concrete group-hover:text-white">[{note.data.tags?.[0]}]</div>
                            <div class="col-span-1 text-right hidden md:block font-mono text-xs text-concrete group-hover:text-white">-></div>
                        </a>
                    )
                })}
            </div>
            <div class="mt-12 text-center">
                 <a href="/notes" class="inline-block border border-white/10 px-8 py-3 font-mono text-xs text-accent hover:bg-accent hover:text-white hover:border-accent transition-colors font-bold">VIEW_ALL_RECORDS</a>
            </div>
        </div>
	</section>

</BaseLayout>

<script>
    // ... Math Hero Script ...
    // (保留之前的 Script 代码，不需要修改)
  const formulas = [
        // --- PHYSICS (物理学) ---
        { tex: "F = \frac{dp}{dt}", link: "https://en.wikipedia.org/wiki/Newton%27s_laws_of_motion" }, // 牛顿第二定律(动量式)
        { tex: "S = k_B \ln \Omega", link: "https://en.wikipedia.org/wiki/Boltzmann%27s_entropy_formula" }, // 玻尔兹曼熵公式
        { tex: "E = h\nu", link: "https://en.wikipedia.org/wiki/Planck_relation" }, // 普朗克关系式
        { tex: "G_{\mu\nu} = 8\pi T_{\mu\nu}", link: "https://en.wikipedia.org/wiki/Einstein_field_equations" }, // 爱因斯坦场方程(极简形式)
        { tex: "\Delta x \Delta p \geq \frac{\hbar}{2}", link: "https://en.wikipedia.org/wiki/Uncertainty_principle" }, // 不确定性原理
        { tex: "PV = nRT", link: "https://en.wikipedia.org/wiki/Ideal_gas_law" }, // 理想气体状态方程
        { tex: "\mathcal{L} = T - V", link: "https://en.wikipedia.org/wiki/Lagrangian_mechanics" }, // 拉格朗日量
        { tex: "\oint \mathbf{E} \cdot d\mathbf{a} = \frac{Q}{\varepsilon_0}", link: "https://en.wikipedia.org/wiki/Gauss%27s_law" }, // 高斯定律
        { tex: "ds^2 = -dt^2 + dx^2", link: "https://en.wikipedia.org/wiki/Minkowski_space" }, // 闵氏时空间隔
        { tex: "f = - \nabla \Phi", link: "https://en.wikipedia.org/wiki/Conservative_force" }, // 保守力场

        // --- MATHEMATICS (数学) ---
        { tex: "a^n + b^n = c^n", link: "https://en.wikipedia.org/wiki/Fermat%27s_Last_Theorem" }, // 费马大定理
        { tex: "e^{i\pi} + 1 = 0", link: "https://en.wikipedia.org/wiki/Euler%27s_identity" }, // 欧拉恒等式
        { tex: "V - E + F = 2", link: "https://en.wikipedia.org/wiki/Euler_characteristic" }, // 欧拉示性数
        { tex: "\det(A-\lambda I) = 0", link: "https://en.wikipedia.org/wiki/Characteristic_polynomial" }, // 特征多项式
        { tex: "i^2 = j^2 = k^2 = -1", link: "https://en.wikipedia.org/wiki/Quaternion" }, // 四元数定义
        { tex: "\frac{df}{dx} = \lim_{h \to 0} \frac{f(x+h)-f(x)}{h}", link: "https://en.wikipedia.org/wiki/Derivative" }, // 导数定义
        { tex: "\langle u, v \rangle \leq \|u\| \|v\|", link: "https://en.wikipedia.org/wiki/Cauchy%E2%80%93Schwarz_inequality" }, // 柯西-施瓦茨不等式
        { tex: "A\mathbf{x} = \lambda\mathbf{x}", link: "https://en.wikipedia.org/wiki/Eigenvalues_and_eigenvectors" }, // 特征值方程

        // --- COMPUTER SCIENCE / AI (计算与人工智能) ---
        { tex: "P(A|B) = \frac{P(B|A)P(A)}{P(B)}", link: "https://en.wikipedia.org/wiki/Bayes%27_theorem" }, // 贝叶斯定理
        { tex: "I(X;Y) = H(X) - H(X|Y)", link: "https://en.wikipedia.org/wiki/Mutual_information" }, // 互信息
        { tex: "\mathbf{w} \cdot \mathbf{x} + b = 0", link: "https://en.wikipedia.org/wiki/Hyperplane" }, // 超平面方程
        { tex: "g = \nabla_\theta \mathcal{L}(\theta)", link: "https://en.wikipedia.org/wiki/Gradient_descent" }, // 随机梯度下降核心
        { tex: "\sigma(x) = \frac{1}{1+e^{-x}}", link: "https://en.wikipedia.org/wiki/Sigmoid_function" }, // Sigmoid 激活函数
        { tex: "O(n \log n)", link: "https://en.wikipedia.org/wiki/Time_complexity" }, // 最优排序复杂度
        { tex: "y = \text{softmax}(z)", link: "https://en.wikipedia.org/wiki/Softmax_function" } // Softmax 
    ];

    function initMathHero() {
        // ... 逻辑同上 ...
        const rawEl = document.getElementById('formula-raw');
        const renderEl = document.getElementById('formula-render');
        const linkEl = document.getElementById('math-link');

        if (!renderEl || !linkEl) return;
        if(rawEl) rawEl.style.display = 'none';

        const selected = formulas[Math.floor(Math.random() * formulas.length)];
        linkEl.setAttribute('href', selected.link);

        renderEl.classList.remove('hidden');
        renderEl.innerHTML = "";

        // @ts-ignore
        if (typeof window.katex === 'undefined') {
            renderEl.innerText = selected.tex;
            renderEl.style.fontFamily = 'monospace';
            return;
        }

        try {
            // @ts-ignore
            window.katex.render(selected.tex, renderEl, { throwOnError: false, displayMode: true });
        } catch (e) { renderEl.innerText = selected.tex; }

        const symbols = renderEl.querySelectorAll('.katex-html .mord, .katex-html .mbin, .katex-html .mrel, .katex-html .mopen, .katex-html .mclose, .katex-html .mpunct, .katex-html .minner');
        
        if (symbols.length === 0) { renderEl.style.opacity = '1'; return; }

        symbols.forEach(el => { (el as HTMLElement).style.opacity = '0'; (el as HTMLElement).style.transition = 'opacity 0.1s ease-out'; });

        let delay = 0;
        const step = 30;
        symbols.forEach((el) => { setTimeout(() => { (el as HTMLElement).style.opacity = '1'; }, delay); delay += step; });
        setTimeout(() => { const allSpans = renderEl.querySelectorAll('span'); allSpans.forEach(el => el.style.opacity = '1'); }, delay + 500);
    }
    document.addEventListener('astro:page-load', initMathHero);
</script>